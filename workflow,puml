@startuml Data Analysis

    title       CSV Data Analysis with LLM

    !define RectangleNode(x) class x << (R,#ADD1B2) >>
    !define DiamondNode(x) class x << (D,#ADD1B2) >>

    START: start
    generate_Python_code : Python code generator\n(Node)
    sanitize_python_script: Python script sanitizer\n(Node)
    execute_python_code: Python code executer\n(Node)
    re_generate_python_code : Python code re-generator\n(Node)
    make_decision : Check if there is is any error or not \n(Node)
    generate_report : Report generator\n(Node)
    
    END: End


    START --> generate_Python_code: (query)
    generate_Python_code --> sanitize_python_script

    sanitize_python_script --> execute_python_code: If Python code is safe to execute
    sanitize_python_script --> re_generate_python_code: If Python code is not safe to execute
    sanitize_python_script --> END: If safe code generation failed after 5 tries

    execute_python_code --> make_decision
    make_decision --> generate_report: If no error in Python code execution
    make_decision --> re_generate_python_code: If error in Python code execution
    make_decision --> END: if Python code execution failed  after 5 tries
    
    re_generate_python_code --> execute_python_code
    generate_report --> END

@enduml
